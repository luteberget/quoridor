<!DOCTYPE html><html><head><meta charset="utf-8"></head>
<script src="/d3.js"></script>
<body><svg id="board"></svg>
<script>

	  var cols = ["a", "b", "c", "d", "e", "f", "g", "h", "i"],
      rows = [9, 8, 7, 6, 5, 4, 3, 2, 1];

  var whitecellcolor = "beige",
      blackcellcolor = "tan",
      textopacity = 0.75,
      perspective = "white";
      size = 500;

 var margin = size*0.06;


var svg = d3.select("#board")
      .attr("width", size + "px")
      .attr("height", size + "px")
    .append("g")
      .attr("transform", "translate(" + margin + "," + margin + ")");

var boardSize = 9;
var gridSize = Math.floor((size - margin - margin) / boardSize);

var griddata = []
for(x = 0;  x < 9; x++) {
for(y = 0;  y < 9; y++) {
	griddata.push([x,y]);
}
}

var nodes = svg.selectAll(".node")
.data(griddata)
.enter().append("g")
.attr("class", "node")
.attr("transform", function(d) { return "translate(" + (d[0])*gridSize + "," + (d[1])*gridSize  + ")"; });

nodes.append("rect")
      .attr("id", function(d){ return cols[d[0]-1] + (9 - d[1]); })
      .attr("fill", function(d){ if ((d[1]+d[0])%2 != 0) return blackcellcolor; else return whitecellcolor; })
      .attr("width", gridSize)
      .attr("height", gridSize);

// nodes.append("text")
//       .text(function(d, i){
// 	var cell = cols[d[0]-1] + (9 - d[1]);
// 	var chesscell = chess.get(cell);
// 	return ((chesscell == null) ? "" : pieces[chesscell.type][chesscell.color]);
//       })
//       .style("text-anchor", "middle")
//       .attr("transform", function(d) { return "translate(" + gridSize/2 + "," + (3/4)*gridSize  + ")"; })
//       .style("font-size", function(d) {
// 	textsize = Math.min(2 * gridSize, (2 * gridSize - 8) / this.getComputedTextLength() * 6.5);
// 	return textsize + "px";
//       })



      svg.selectAll(".colLabel")
          .data(cols)
          .enter().append("text")
            .text(function (d) { return d; })
            .attr("y", 0)
            .attr("x", function (d, i) { return i * gridSize; })
            .style("font-size", gridSize/3 + "px")
            .style("text-anchor", "middle")
            .style("opacity", textopacity)
            .attr("transform", "translate(" + gridSize / 2 + ", " + -6 + "  )")

      /* left */
      svg.selectAll(".rowLabel")
          .data(rows)
          .enter().append("text")
            .text(function(d) { return d; })
            .attr("y", function(d, i) { return i * gridSize; })
            .attr("x", 0)
            .style("font-size", gridSize/3 + "px")
            .style("text-anchor", "middle")
            .style("opacity", textopacity)
            .attr("transform", "translate(-18," + gridSize / 1.5 + ")")

      /* bottom */
      svg.selectAll(".colLabel")
          .data(cols)
          .enter().append("text")
            .text(function (d) { return d; })
            .attr("y", 0)
            .attr("x", function (d, i) { return i * gridSize; })
            .style("font-size", gridSize/3 + "px")
            .style("text-anchor", "middle")
            .style("opacity", textopacity)
            .attr("transform", "translate(" + gridSize / 2 + ", " + ( (size - margin - margin) + gridSize/3) + "  )")

      /* right */
      svg.selectAll(".rowLabel")
          .data(rows)
          .enter().append("text")
            .text(function(d) { return d; })
            .attr("y", function(d, i) { return i * gridSize; })
            .attr("x", 0)
            .style("font-size", gridSize/3 + "px")
            .style("text-anchor", "middle")
            .style("opacity", textopacity)
            .attr("transform", "translate(" + ((size - margin - margin) + 18) + "," + gridSize / 1.5 + ")")


var data;






var socket = new WebSocket("ws://" + window.location.host + "/ws");
socket.onmessage = function (event) {
	console.log("Received");
	console.log(event.data);

	var t = d3.transition()
		.duration(300);


      data = JSON.parse(event.data);
	console.log(data);
	console.log(data.positions);
	console.log(data.positions[0]);
	console.log([data.positions[0]]);
	var players = svg.selectAll(".player").data(data.positions);

	players.enter().append("circle")
		.attr("class","player")
		.attr("cx", function(d) { return gridSize*(d.x-0.5); })
		.attr("cy", function(d) { return gridSize*(boardSize - d.y+0.5); })
		.attr("fill", function(d,i) { if (i == 0) { return "red"; } else { return "blue"; } })
		.attr("r", (gridSize/3));

	players.transition(t)
		.attr("cx", function(d) { return gridSize*(d.x-0.5); })
		.attr("cy", function(d) { return gridSize*(boardSize - d.y+0.5); });

	var walls = svg.selectAll(".wall").data(data.walls);
	
	// TODO receive also win status and player's turn

};

</script>
</body> </html>
